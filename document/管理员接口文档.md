# 电影票销售管理系统 管理员接口文档

## 1. 接口基础信息

### 1.1 基本 URL
```
http://localhost:8080/api/v1
```

### 1.2 请求/响应格式
- **请求格式**：JSON
- **响应格式**：JSON
- **编码**：UTF-8

### 1.3 响应状态码
| 状态码 | 描述 |
| ---- | ---- |
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 1.4 认证方式
- **管理员认证**：JWT Token（管理员专用）
- **Token 传递方式**：Authorization Header，格式为 `Bearer {token}`

## 2. 管理员认证模块

### 2.1 管理员登录

**URL**：`/auth/admin/login`
**方法**：`POST`
**请求体**：
```json
{
  "username": "string",
  "password": "string"
}
```
**响应**：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "string",
    "admin": {
      "adminId": 1,
      "username": "admin"
    }
  }
}
```

### 2.2 管理员注册

**URL**：`/auth/admin/register`
**方法**：`POST`
**请求体**：
```json
{
  "username": "string",
  "password": "string"
}
```
**响应**：
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "adminId": 1,
    "username": "admin"
  }
}
```

## 3. 管理员管理模块

### 3.1 获取用户列表

**URL**：`/admin/users`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：

- `page`：页码，默认 1
- `limit`：每页数量，默认 10
- `status`：用户状态，可选
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 100,
    "records": [
      {
        "userId": 1,
        "username": "string",
        "nickname": "string",
        "phone": "string",
        "avatarUrl": "string",
        "status": 0,
        "createdAt": "string"
      }
    ]
  }
}
```

### 3.2 封禁用户

**URL**：`/admin/users/{userId}/ban`
**方法**：`PUT`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "封禁成功",
  "data": null
}
```

### 3.3 解除封禁

**URL**：`/admin/users/{userId}/unban`
**方法**：`PUT`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "解除封禁成功",
  "data": null
}
```

## 4. 影片管理模块

### 4.1 新增影片

**URL**：`/admin/movies`
**方法**：`POST`
**认证**：需要管理员 Token
**请求体**：

```json
{
  "title": "沙丘2",
  "originalTitle": "Dune: Part Two",
  "tmdbId": 438631,
  "duration": 166,
  "releaseDate": "2024-03-01",
  "language": "English",
  "country": "United States",
  "rating": "PG-13",
  "synopsis": "保罗·厄崔迪与弗雷曼人联手，向背叛他家族的人复仇。",
  "posterUrl": "string",
  "backdropUrl": "string",
  "status": "released",
  "genreList" : [
    {
        "genreId" : 1
    },
    {
        "genreId": 2
    }
  ],
  "actorList" : [
    {
        "actorId" : 1,
        "roleName" : "大"
    },
    {
        "actorId": 2,
        "roleName" : "小"
    }
  ]
}
```
**响应**：

```json
{
  "code": 200,
  "message": "添加成功",
  "data": null
}
```

### 4.2 更新影片

**URL**：`/admin/movies/{movieId}`
**方法**：`PUT`
**认证**：需要管理员 Token
**请求体**：
```json
{
  "title": "沙丘2",
  "originalTitle": "Dune: Part Two",
  "tmdbId": 438631,
  "duration": 166,
  "releaseDate": "2024-03-01",
  "language": "English",
  "country": "United States",
  "rating": "PG-13",
  "synopsis": "保罗·厄崔迪与弗雷曼人联手，向背叛他家族的人复仇。",
  "posterUrl": "string",
  "backdropUrl": "string",
  "status": "released",
  "genreList" : [
    {
        "genreId" : 1
    },
    {
        "genreId": 2
    }
  ],
  "actorList" : [
    {
        "actorId" : 1,
        "roleName" : "大"
    },
    {
        "actorId": 2,
        "roleName" : "小"
    }
  ]
}
```
**响应**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 4.3 删除影片

**URL**：`/admin/movies/{movieId}`
**方法**：`DELETE`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 4.4 获取影片列表

**URL**：`/admin/movies`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：

- `page`：页码，默认 1
- `limit`：每页数量，默认 10
- `status`：影片状态，可选
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 50,
    "records": [
      {
        "movieId": 1,
        "title": "沙丘2",
        "originalTitle": "Dune: Part Two",
        "tmdbId": 438631,
        "duration": 166,
        "releaseDate": "2024-03-01",
        "rating": "PG-13",
        "posterUrl": "string",
        "status": "released"
      }
    ]
  }
}
```

## 5. 影厅管理模块

### 5.1 获取影厅列表

**URL**：`/admin/halls`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：

- `page`：页码，默认 1
- `limit`：每页数量，默认 10
- `status`：影厅状态，可选
**响应**：
```json
{
    "code": 1,
    "msg": null,
    "data": {
        "total": 4,
        "records": [
            {
                "hallId": 1,
                "hallName": "1号厅",
                "totalSeats": 120,
                "hallType": "standard",
                "status": 0,
                "createdAt": "2025-12-14 07:43:34"
            },
            {
                "hallId": 2,
                "hallName": "IMAX厅",
                "totalSeats": 260,
                "hallType": "imax",
                "status": 0,
                "createdAt": "2025-12-14 07:43:34"
            }
        ]
    }
}
```

### 5.2 新增影厅

**URL**：`/admin/halls`
**方法**：`POST`
**认证**：需要管理员 Token
**请求体**：

```json
{
  "hallName": "3号厅",
  "totalSeats": 100,
  "hallType": "standard",
  "status": 0
}
```
**响应**：

```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "hallId": 1
  }
}
```

### 5.3 更新影厅

**URL**：`/admin/halls/{hallId}`
**方法**：`PUT`
**认证**：需要管理员 Token
**请求体**：

```json
{
    "hallId": 1,
    "hallName": "1号厅",
    "totalSeats": 130,
    "hallType": "standard",
    "status": 0
}
```
**响应**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 5.4 删除影厅

**URL**：`/admin/halls/{hallId}`
**方法**：`DELETE`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

### 5.5 封禁影厅

**URL**：`/admin/halls/{hallId}/ban`
**方法**：`PUT`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "封禁成功",
  "data": null
}
```

### 5.6 解封影厅

**URL**：`/admin/halls/{hallId}/unban`
**方法**：`PUT`
**认证**：需要管理员 Token
**响应**：

```json
{
  "code": 200,
  "message": "解封成功",
  "data": null
}
```

## 6. 排片管理模块

### 6.1 获取排片列表

**URL**：`/admin/schedules`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：
- `page`：页码，默认 1
- `limit`：每页数量，默认 10
- `movieId`：影片 ID，可选
- `hallId`：影厅 ID，可选
- `date`：日期，格式 YYYY-MM-DD，可选
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 10,
    "records": [
      {
        "scheduleId": 1,
        "movieId": 1,
        "hallId": 1,
        "startTime": "2024-12-01 19:30:00",
        "price": 45.00
      }
    ]
  }
}
```

### 6.2 新增排片

**URL**：`/admin/schedules`
**方法**：`POST`
**认证**：需要管理员 Token
**请求体**：
```json
{
  "movieId": 1,
  "hallId": 1,
  "startTime": "2024-12-01 19:30:00",
  "price": 45.00
}
```
**响应**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "scheduleId": 1
  }
}
```

### 6.3 更新排片

**URL**：`/admin/schedules/{scheduleId}`
**方法**：`PUT`
**认证**：需要管理员 Token
**请求体**：
```json
{
  "movieId": 1,
  "hallId": 1,
  "startTime": "2024-12-01 19:30:00",
  "price": 45.00
}
```
**响应**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

### 6.4 删除排片

**URL**：`/admin/schedules/{scheduleId}`
**方法**：`DELETE`
**认证**：需要管理员 Token
**响应**：
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

## 7. 座位管理模块

### 7.1 设置影厅座位

**URL**：`/admin/halls/{hallId}/seats`
**方法**：`POST`
**认证**：需要管理员 Token
**请求体**：
```json
{
  "seats": [
    {
      "rowLabel": "A",
      "colNumber": 1,
      "isAvailable": true
    }
  ]
}
```
**响应**：
```json
{
  "code": 200,
  "message": "设置成功",
  "data": null
}
```

## 8. 订单管理模块

### 8.1 获取订单列表

**URL**：`/admin/orders`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：
- `page`：页码，默认 1
- `limit`：每页数量，默认 10
- `status`：订单状态，可选
- `startDate`：开始日期，可选
- `endDate`：结束日期，可选
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 200,
    "records": [
      {
        "orderId": 1,
        "userId": 1,
        "username": "string",
        "movieTitle": "沙丘2",
        "startTime": "2024-12-01 19:30:00",
        "hallName": "3号厅",
        "seats": "A1,A2,A3",
        "totalAmount": 135.00,
        "status": "paid",
        "createdAt": "2024-12-01 18:00:00",
        "paidAt": "2024-12-01 18:05:00"
      }
    ]
  }
}
```

### 8.2 更新订单状态

**URL**：`/admin/orders/{orderId}/status`
**方法**：`PUT`
**认证**：需要管理员 Token
**请求体**：
```json
{
  "status": "cancelled"
}
```
**响应**：
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

## 9. 管理员统计模块

### 9.1 获取仪表盘数据

**URL**：`/admin/dashboard`
**方法**：`GET`
**认证**：需要管理员 Token
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "totalUsers": 1000,
    "totalMovies": 50,
    "totalOrders": 2000,
    "totalRevenue": 90000.00,
    "todayRevenue": 1500.00,
    "topMovies": [
      {
        "movieId": 1,
        "title": "沙丘2",
        "boxOffice": 30000.00,
        "salesCount": 667
      }
    ]
  }
}
```

### 9.2 获取票房统计

**URL**：`/admin/statistics/box-office`
**方法**：`GET`
**认证**：需要管理员 Token
**请求参数**：
- `startDate`：开始日期，必填
- `endDate`：结束日期，必填
**响应**：
```json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "totalBoxOffice": 90000.00,
    "dailyBoxOffice": [
      {
        "date": "2024-12-01",
        "revenue": 1500.00,
        "salesCount": 34
      }
    ],
    "movieBoxOffice": [
      {
        "movieId": 1,
        "title": "沙丘2",
        "revenue": 30000.00,
        "percentage": 33.33
      }
    ]
  }
}
```

## 10. 错误码说明

| 错误码 | 描述 |
| ---- | ---- |
| 10001 | 用户名已存在 |
| 10002 | 手机号已存在 |
| 10003 | 手机号格式错误 |
| 10004 | 密码错误 |
| 10005 | 用户不存在 |
| 10006 | 新密码格式错误 |
| 20001 | 影片不存在 |
| 20002 | 影厅不存在 |
| 20003 | 场次不存在 |
| 20004 | 座位不可用 |
| 30001 | 订单不存在 |
| 30002 | 订单状态错误 |
| 50000 | 系统错误 |

## 11. 数据模型说明

### 11.1 管理员模型 (Admin)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| adminId | INT | 管理员唯一ID |
| username | VARCHAR(50) | 管理员用户名 |
| passwordHash | VARCHAR(255) | 密码哈希 |
| createdAt | DATETIME | 创建时间 |

### 11.2 影片模型 (Movie)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| movieId | INT | 影片唯一ID |
| title | VARCHAR(150) | 影片中文名称 |
| originalTitle | VARCHAR(150) | 原始语言片名 |
| tmdbId | INT | TMDb唯一ID，用于对接第三方API |
| duration | INT | 片长（分钟） |
| releaseDate | DATE | 上映日期 |
| language | VARCHAR(50) | 主要对白语言 |
| country | VARCHAR(100) | 制片国家或地区 |
| rating | VARCHAR(20) | 内容分级 |
| synopsis | TEXT | 剧情简介 |
| posterUrl | VARCHAR(255) | 主海报URL |
| backdropUrl | VARCHAR(255) | 背景图URL |
| status | ENUM | 状态：upcoming-即将上映，released-已上映，removed-已下架 |

### 11.3 影厅模型 (Hall)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| hallId | INT | 影厅唯一ID |
| hallName | VARCHAR(50) | 影厅名称 |
| totalSeats | INT | 总座位数 |
| hallType | VARCHAR(20) | 影厅类型：standard-标准厅，imax-IMAX厅，vip-VIP厅 |
| status | TINYINT | 状态：0-正常，1-维护中 |
| createdAt | DATETIME | 创建时间 |

### 11.4 排片模型 (Schedule)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| scheduleId | INT | 排片唯一ID |
| movieId | INT | 关联影片ID |
| hallId | INT | 关联影厅ID |
| startTime | DATETIME | 开始时间 |
| price | DECIMAL(10,2) | 票价 |
| createdAt | DATETIME | 创建时间 |

### 11.5 座位模型 (Seat)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| seatId | INT | 座位唯一ID |
| hallId | INT | 关联影厅ID |
| rowLabel | VARCHAR(10) | 行标识 |
| colNumber | INT | 列号 |
| isAvailable | TINYINT | 是否可用 |

### 11.6 订单模型 (Order)
| 字段名 | 类型 | 描述 |
| ---- | ---- | ---- |
| orderId | INT | 订单唯一ID |
| userId | INT | 下单用户ID |
| scheduleId | INT | 关联场次ID |
| totalAmount | DECIMAL(10,2) | 订单总金额 |
| status | ENUM | 订单状态：pending-待支付，paid-已支付，cancelled-已取消，refunded-已退款 |
| qrCode | VARCHAR(255) | 电子票二维码 |
| createdAt | DATETIME | 订单创建时间 |
| paidAt | DATETIME | 支付完成时间 |

---

**文档版本**：v1.0
**更新日期**：2024-12-01
**作者**：系统开发团队